'use strict';

var taskFactory = require('./tasks/taskFactory.js');
var zdmUtils = require('./zdmUtils.js');

exports.deploy = function deploy(deployCb, options, services, logger, hdiDeployerCb) {
    function validateZdmServiceReplacements() {
        services.getServiceUsingServiceReplacements(zdmUtils.logicalServiceDataContainer);
        services.getServiceUsingServiceReplacements(zdmUtils.logicalServiceAccessContainer);
    }

    try {
        validateZdmServiceReplacements();
        var task = taskFactory.createTask(process.env.HDI_DEPLOY_ZDM_ACTION, deployCb, options, services, logger, hdiDeployerCb);
        task.start();
    } catch (err) {
        logger.error(err.message);
        return hdiDeployerCb(new Error(zdmUtils.failureFinalMsg + " [" + zdmUtils.deployId + "]"));
    }
};
